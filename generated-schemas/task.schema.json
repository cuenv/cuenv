{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "TaskDefinition",
  "description": "A task definition can be either a single task or a group of tasks",
  "anyOf": [
    {
      "description": "A single task",
      "$ref": "#/$defs/Task"
    },
    {
      "description": "A group of tasks",
      "$ref": "#/$defs/TaskGroup"
    }
  ],
  "$defs": {
    "ExternalInput": {
      "description": "Cross-project external input declaration",
      "type": "object",
      "properties": {
        "map": {
          "description": "Required explicit mappings",
          "type": "array",
          "items": {
            "$ref": "#/$defs/Mapping"
          }
        },
        "project": {
          "description": "Path to project root relative to env.cue or absolute-from-repo-root",
          "type": "string"
        },
        "task": {
          "description": "Name of the external task in that project",
          "type": "string"
        }
      },
      "required": [
        "project",
        "task",
        "map"
      ]
    },
    "Mapping": {
      "description": "Mapping of external output to local workspace path",
      "type": "object",
      "properties": {
        "from": {
          "description": "Path relative to external project root of a declared output from the external task",
          "type": "string"
        },
        "to": {
          "description": "Path inside the dependent taskâ€™s hermetic workspace where this file/dir will be materialized",
          "type": "string"
        }
      },
      "required": [
        "from",
        "to"
      ]
    },
    "Shell": {
      "description": "Shell configuration for task execution",
      "type": "object",
      "properties": {
        "command": {
          "description": "Shell executable name (e.g., \"bash\", \"fish\", \"zsh\")",
          "type": [
            "string",
            "null"
          ]
        },
        "flag": {
          "description": "Flag for command execution (e.g., \"-c\", \"--command\")",
          "type": [
            "string",
            "null"
          ]
        }
      }
    },
    "Task": {
      "description": "A single executable task",
      "type": "object",
      "properties": {
        "args": {
          "description": "Arguments for the command",
          "type": "array",
          "default": [],
          "items": {
            "type": "string"
          }
        },
        "command": {
          "description": "Command to execute",
          "type": "string"
        },
        "dependsOn": {
          "description": "Task dependencies (names of tasks that must run first)",
          "type": "array",
          "default": [],
          "items": {
            "type": "string"
          }
        },
        "description": {
          "description": "Description of the task",
          "type": [
            "string",
            "null"
          ],
          "default": null
        },
        "env": {
          "description": "Environment variables for this task",
          "type": "object",
          "additionalProperties": true,
          "default": {}
        },
        "externalInputs": {
          "description": "Cross-project inputs",
          "type": [
            "array",
            "null"
          ],
          "default": null,
          "items": {
            "$ref": "#/$defs/ExternalInput"
          }
        },
        "inputs": {
          "description": "Input files/resources",
          "type": "array",
          "default": [],
          "items": {
            "type": "string"
          }
        },
        "outputs": {
          "description": "Output files/resources",
          "type": "array",
          "default": [],
          "items": {
            "type": "string"
          }
        },
        "shell": {
          "description": "Shell configuration for command execution (optional)",
          "anyOf": [
            {
              "$ref": "#/$defs/Shell"
            },
            {
              "type": "null"
            }
          ],
          "default": null
        },
        "workspaceInputs": {
          "description": "Workspace resolution configuration",
          "anyOf": [
            {
              "$ref": "#/$defs/WorkspaceInputs"
            },
            {
              "type": "null"
            }
          ],
          "default": null
        }
      },
      "required": [
        "command"
      ]
    },
    "TaskGroup": {
      "description": "Represents a group of tasks with execution mode",
      "anyOf": [
        {
          "description": "Sequential execution: array of tasks executed in order",
          "type": "array",
          "items": {
            "$ref": "#"
          }
        },
        {
          "description": "Parallel execution: named tasks that can run concurrently",
          "type": "object",
          "additionalProperties": {
            "$ref": "#"
          }
        }
      ]
    },
    "WorkspaceInputs": {
      "description": "Configuration for workspace-aware dependency resolution",
      "type": "object",
      "properties": {
        "enabled": {
          "description": "Whether to enable workspace resolution",
          "type": "boolean",
          "default": true
        },
        "lockfile": {
          "description": "Path to the lockfile",
          "type": [
            "string",
            "null"
          ]
        },
        "packageManager": {
          "description": "Explicit package manager override",
          "type": [
            "string",
            "null"
          ]
        },
        "packages": {
          "description": "Explicit list of packages to include",
          "type": "array",
          "default": [],
          "items": {
            "type": "string"
          }
        }
      }
    }
  }
}