---
title: cuenv-ignore
description: Generate ignore files for Git, Docker, npm, and other tools
---

The `cuenv-ignore` crate provides a builder-based API for generating tool-specific ignore files (`.gitignore`, `.dockerignore`, etc.) from declarative configuration.

## Overview

Managing multiple ignore files across different tools can be tedious. This crate lets you:

- Generate any `.*ignore` file from a common configuration
- Track file status (Created, Updated, Unchanged)
- Validate against Git repository boundaries
- Preview changes with dry-run mode

## Architecture

```text
┌────────────────────┐     ┌─────────────────┐     ┌──────────────────┐
│  IgnoreFilesBuilder│────►│   IgnoreFile    │────►│  .*ignore files  │
│  (configuration)   │     │   (per-tool)    │     │  (.gitignore,    │
└────────────────────┘     └─────────────────┘     │   .dockerignore) │
         │                                          └──────────────────┘
         ▼
┌────────────────────┐
│    SyncResult      │
│ (status tracking)  │
└────────────────────┘
```

### Key Components

**IgnoreFile**
Configuration for a single ignore file, including tool name, patterns, and optional header.

**IgnoreFiles**
Entry point for building and generating multiple ignore files.

**IgnoreFilesBuilder**
Fluent builder for configuring the generation process.

**SyncResult / FileResult**
Results tracking what happened to each file (Created, Updated, Unchanged).

## API Reference

### IgnoreFile

Configuration for a single ignore file:

```rust
use cuenv_ignore::IgnoreFile;

let file = IgnoreFile::new("git")
    .pattern("node_modules/")
    .pattern(".env")
    .pattern("target/")
    .header("Generated by my-tool\nDo not edit");

// Default filename is .{tool}ignore
assert_eq!(file.output_filename(), ".gitignore");

// Generate content
let content = file.generate();
```

| Method              | Description                                      |
| ------------------- | ------------------------------------------------ |
| `new(tool)`         | Create config for a tool (e.g., "git", "docker") |
| `pattern(str)`      | Add a single pattern                             |
| `patterns(iter)`    | Add multiple patterns                            |
| `filename(str)`     | Override output filename                         |
| `header(str)`       | Set header comment                               |
| `output_filename()` | Get output filename (`.{tool}ignore` or custom)  |
| `tool()`            | Get tool name                                    |
| `patterns_list()`   | Get patterns slice                               |
| `generate()`        | Generate file content                            |

### IgnoreFiles / IgnoreFilesBuilder

Entry point and builder for generating multiple files:

```rust
use cuenv_ignore::{IgnoreFile, IgnoreFiles};

let result = IgnoreFiles::builder()
    .directory(".")
    .require_git_repo(true)
    .dry_run(false)
    .file(IgnoreFile::new("git")
        .pattern("node_modules/")
        .pattern(".env"))
    .file(IgnoreFile::new("docker")
        .pattern("target/"))
    .generate()?;

for file in &result.files {
    println!("{}: {}", file.status, file.filename);
}
```

| Builder Method           | Description                                 |
| ------------------------ | ------------------------------------------- |
| `directory(path)`        | Set output directory (default: current dir) |
| `file(IgnoreFile)`       | Add a single ignore file config             |
| `files(iter)`            | Add multiple ignore file configs            |
| `require_git_repo(bool)` | Require directory to be in a Git repo       |
| `dry_run(bool)`          | Preview changes without writing             |
| `generate()`             | Generate all ignore files                   |

### FileStatus

Status of each file operation:

```rust
use cuenv_ignore::FileStatus;

match status {
    FileStatus::Created => println!("New file created"),
    FileStatus::Updated => println!("Existing file updated"),
    FileStatus::Unchanged => println!("No changes needed"),
    FileStatus::WouldCreate => println!("Would create (dry-run)"),
    FileStatus::WouldUpdate => println!("Would update (dry-run)"),
}
```

### Error Types

```rust
use cuenv_ignore::Error;

match err {
    Error::InvalidToolName { name, reason } => { /* bad tool name */ }
    Error::NotInGitRepo => { /* require_git_repo failed */ }
    Error::BareRepository => { /* can't operate in bare repo */ }
    Error::OutsideGitRepo => { /* path outside repo root */ }
    Error::Io(e) => { /* file I/O error */ }
}
```

## Features

| Feature | Description                          |
| ------- | ------------------------------------ |
| `serde` | Enable serialization/deserialization |

```toml
[dependencies]
cuenv-ignore = { version = "...", features = ["serde"] }
```

## Integration Patterns

### Basic Usage

```rust
use cuenv_ignore::{IgnoreFile, IgnoreFiles};

fn main() -> cuenv_ignore::Result<()> {
    let result = IgnoreFiles::builder()
        .directory(".")
        .file(IgnoreFile::new("git")
            .pattern("node_modules/")
            .pattern("dist/")
            .pattern(".env")
            .pattern("*.log"))
        .generate()?;

    for file in &result.files {
        println!("{}: {} ({} patterns)",
            file.status, file.filename, file.pattern_count);
    }
    Ok(())
}
```

### Multiple Tools

```rust
use cuenv_ignore::{IgnoreFile, IgnoreFiles};

let result = IgnoreFiles::builder()
    .directory("/path/to/project")
    .file(IgnoreFile::new("git")
        .header("Git ignore patterns")
        .pattern("node_modules/")
        .pattern(".env")
        .pattern("*.log"))
    .file(IgnoreFile::new("docker")
        .header("Docker build ignore")
        .pattern("node_modules/")
        .pattern(".git/")
        .pattern("*.md"))
    .file(IgnoreFile::new("npm")
        .pattern("src/")
        .pattern("tests/"))
    .generate()?;

// Creates .gitignore, .dockerignore, .npmignore
```

### Dry-Run Mode

Preview what would happen without writing files:

```rust
use cuenv_ignore::{IgnoreFile, IgnoreFiles, FileStatus};

let result = IgnoreFiles::builder()
    .directory(".")
    .dry_run(true)  // Don't write files
    .file(IgnoreFile::new("git").pattern("*.log"))
    .generate()?;

for file in &result.files {
    match file.status {
        FileStatus::WouldCreate => println!("Would create: {}", file.filename),
        FileStatus::WouldUpdate => println!("Would update: {}", file.filename),
        FileStatus::Unchanged => println!("No changes: {}", file.filename),
        _ => {}
    }
}
```

### Custom Filenames

```rust
use cuenv_ignore::IgnoreFile;

// Use custom filename instead of default
let file = IgnoreFile::new("custom")
    .filename(".my-custom-ignore")
    .pattern("temp/");

assert_eq!(file.output_filename(), ".my-custom-ignore");
```

### Git Repository Validation

```rust
use cuenv_ignore::{IgnoreFile, IgnoreFiles, Error};

let result = IgnoreFiles::builder()
    .directory("/some/path")
    .require_git_repo(true)  // Validate Git repo
    .file(IgnoreFile::new("git").pattern("*.log"))
    .generate();

match result {
    Err(Error::NotInGitRepo) => println!("Not in a Git repository"),
    Err(Error::BareRepository) => println!("Can't use bare repositories"),
    Err(Error::OutsideGitRepo) => println!("Path is outside repo root"),
    Ok(result) => println!("Generated {} files", result.files.len()),
    Err(e) => println!("Error: {e}"),
}
```

## Security

The crate includes security validations:

- Tool names cannot contain path separators (`/`, `\`)
- Tool names cannot contain parent directory references (`..`)
- Filenames are validated against path traversal

```rust
use cuenv_ignore::{IgnoreFile, IgnoreFiles};

// This will fail validation
let result = IgnoreFiles::builder()
    .file(IgnoreFile::new("../etc/passwd").pattern("*"))
    .generate();
// Error: InvalidToolName
```

## Testing

```bash
# Run all ignore tests
cargo test -p cuenv-ignore

# Run with features
cargo test -p cuenv-ignore --features serde
```

## See Also

- [cuenv-codeowners](/explanation/cuenv-codeowners/) - Generate CODEOWNERS files
- [How-to: Ignore files](/how-to/ignore-files/) - Using ignore files with cuenv
- [API Reference](/reference/rust-api/) - Complete API documentation
