= Contributing
:description: Guide for contributing to cuenv
:keywords: contributing, development, open-source

We welcome contributions to cuenv! This guide will help you get started with contributing code, documentation, and ideas.

== Getting Started

=== Prerequisites

* Rust 1.70+ (install via https://rustup.rs/[rustup^])
* Git for version control
* Nix (optional, for reproducible development environment)
* Go 1.21+ (for CUE engine development)

=== Development Setup

[source,bash]
----
# Clone the repository
git clone https://github.com/cuenv/cuenv.git
cd cuenv

# Set up development environment
devenv shell  # or nix-shell

# Build the project
cargo build

# Run tests
cargo test --workspace
----

== Code Contributions

=== Finding Issues to Work On

* Check the https://github.com/cuenv/cuenv/issues[issue tracker^]
* Look for issues labeled `good first issue` or `help wanted`
* Join https://github.com/cuenv/cuenv/discussions[discussions^] to propose new features

=== Development Workflow

1. **Fork and Clone**
+
[source,bash]
----
# Fork on GitHub, then clone your fork
git clone https://github.com/YOUR_USERNAME/cuenv.git
cd cuenv
git remote add upstream https://github.com/cuenv/cuenv.git
----

2. **Create a Branch**
+
[source,bash]
----
git checkout -b feature/my-new-feature
----

3. **Make Changes**
+
* Follow the coding standards below
* Write tests for new functionality
* Update documentation as needed

4. **Test Your Changes**
+
[source,bash]
----
# Run all tests
cargo test --workspace

# Run specific crate tests
cargo test -p cuengine
cargo test -p cuenv-core
cargo test -p cuenv-cli

# Run linting
cargo clippy -- -D warnings

# Format code
cargo fmt
----

5. **Commit and Push**
+
[source,bash]
----
git add .
git commit -m "feat: add new feature description"
git push origin feature/my-new-feature
----

6. **Create Pull Request**
+
* Open a PR on GitHub
* Fill out the PR template
* Link any related issues

=== Coding Standards

==== Rust Code Style

* Follow standard Rust formatting (`cargo fmt`)
* Use `cargo clippy` for linting
* Document public APIs with rustdoc comments
* Write unit tests for all public functions

[source,rust]
----
/// Evaluates a CUE expression and returns the result.
/// 
/// # Arguments
/// 
/// * `input` - The CUE expression to evaluate
/// * `options` - Configuration options for evaluation
/// 
/// # Returns
/// 
/// Returns the evaluated result as JSON or an error
/// 
/// # Examples
/// 
/// ```rust
/// use cuengine::{evaluate_cue, EvaluationOptions};
/// 
/// let result = evaluate_cue("{ name: \"test\" }", &EvaluationOptions::default())?;
/// assert_eq!(result["name"], "test");
/// ```
pub fn evaluate_cue(input: &str, options: &EvaluationOptions) -> Result<Value, CueError> {
    // Implementation
}
----

==== Error Handling

Use structured error types with `thiserror`:

[source,rust]
----
#[derive(Debug, thiserror::Error)]
pub enum MyError {
    #[error("Configuration error: {message}")]
    Config { message: String },
    
    #[error("IO error")]
    Io(#[from] std::io::Error),
}
----

==== Testing

Write comprehensive tests using Rust's built-in test framework:

[source,rust]
----
#[cfg(test)]
mod tests {
    use super::*;
    
    #[test]
    fn test_basic_evaluation() {
        let input = "{ value: 42 }";
        let result = evaluate_cue(input, &EvaluationOptions::default()).unwrap();
        assert_eq!(result["value"], 42);
    }
    
    #[test]
    fn test_error_handling() {
        let input = "{ invalid syntax";
        let result = evaluate_cue(input, &EvaluationOptions::default());
        assert!(result.is_err());
    }
}
----

=== Project Structure

----
cuenv/
â”œâ”€â”€ crates/
â”‚   â”œâ”€â”€ cuengine/          # CUE evaluation engine
â”‚   â”œâ”€â”€ cuenv-core/        # Core library
â”‚   â””â”€â”€ cuenv-cli/         # CLI application
â”œâ”€â”€ docs/                  # Documentation source
â”œâ”€â”€ examples/              # Example configurations
â”œâ”€â”€ schema/                # CUE schemas
â””â”€â”€ tests/                 # Integration tests
----

=== Adding New Features

When adding new features:

1. **Design First**: Discuss the design in an issue or discussion
2. **Start Small**: Implement the minimal viable version
3. **Test Thoroughly**: Add unit and integration tests
4. **Document**: Update relevant documentation
5. **Performance**: Consider performance implications

=== Working with FFI

For changes to the CUE engine FFI:

1. **Go Side**: Update `cue-engine/bridge.go`
2. **Rust Side**: Update `cuengine/src/ffi.rs`
3. **Test Both**: Ensure both Go and Rust tests pass
4. **Memory Safety**: Verify proper memory management

== Documentation Contributions

=== Documentation Structure

Documentation uses AsciiDoc and Antora:

* Source files in `docs/modules/ROOT/pages/`
* Navigation defined in `docs/modules/ROOT/nav.adoc`
* Build with `npm run docs:build`

=== Writing Guidelines

* Use clear, concise language
* Include code examples for APIs
* Add cross-references between related topics
* Test all code examples

=== Building Documentation

[source,bash]
----
# Install dependencies
npm install

# Build documentation
npm run docs:build

# Serve locally for preview
npm run docs:serve
----

== Bug Reports

=== Before Reporting

* Check if the issue already exists
* Try to reproduce with the latest version
* Create a minimal reproduction case

=== Bug Report Template

When reporting bugs, include:

* **Environment**: OS, Rust version, cuenv version
* **Steps to Reproduce**: Clear, numbered steps
* **Expected Behavior**: What should happen
* **Actual Behavior**: What actually happens
* **Reproduction Case**: Minimal code/config to reproduce

=== Example Bug Report

[source,markdown]
----
## Bug Description
CUE evaluation fails with circular reference error

## Environment
- OS: Ubuntu 20.04
- Rust: 1.75.0
- cuenv: 0.1.0

## Steps to Reproduce
1. Create file `config.cue` with content:
   ```cue
   a: b
   b: a
   ```
2. Run `cuenv validate config.cue`

## Expected Behavior
Should report circular reference error clearly

## Actual Behavior
Crashes with panic: "stack overflow"

## Reproduction Case
[Link to minimal repo or paste configuration]
----

== Feature Requests

=== Before Requesting

* Check if a similar feature exists or is planned
* Consider if it fits with cuenv's goals
* Think about implementation complexity

=== Feature Request Template

Include:

* **Use Case**: Why is this needed?
* **Proposal**: How should it work?
* **Alternatives**: What other solutions exist?
* **Implementation**: Any implementation ideas?

== Release Process

=== Versioning

cuenv follows Semantic Versioning:

* **Major** (1.0.0): Breaking changes
* **Minor** (0.1.0): New features, backwards compatible  
* **Patch** (0.1.1): Bug fixes

=== Release Checklist

For maintainers preparing releases:

1. Update version numbers in `Cargo.toml` files
2. Update `CHANGELOG.md`
3. Run full test suite
4. Build documentation
5. Tag release
6. Publish to crates.io

== Community Guidelines

=== Code of Conduct

We follow the https://www.contributor-covenant.org/[Contributor Covenant^] code of conduct. Be respectful and inclusive.

=== Communication

* **GitHub Issues**: Bug reports and feature requests
* **GitHub Discussions**: General questions and design discussions  
* **Pull Requests**: Code contributions and reviews

=== Getting Help

* Read the documentation first
* Search existing issues and discussions
* Ask specific questions with context
* Provide minimal reproduction cases

== Recognition

Contributors will be:

* Listed in `CONTRIBUTORS.md`
* Mentioned in release notes for significant contributions
* Invited to join the cuenv organization (for regular contributors)

Thank you for contributing to cuenv! ðŸŽ‰