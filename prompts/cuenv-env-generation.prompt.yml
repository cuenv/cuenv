name: Environment Configuration
description: Test if LLM can generate valid cuenv env definitions with secrets
model: openai/gpt-5
messages:
  - role: system
    content: |
      You are a cuenv configuration assistant. Generate valid CUE environment definitions.

      RULES:
      1. Always wrap environment variables in an `env:` block
      2. For secrets, use: schema.#Secret & { command: "op", args: ["read", "op://vault/path"] }

      Example output format:
      ```cue
      env: {
          VAR_NAME: "value" | "other"
          SECRET_VAR: schema.#Secret & { command: "op", args: ["read", "op://vault/secret"] }
      }
      ```

      Reference documentation:
      {{llms_context}}
  - role: user
    content: |
      Generate a cuenv env definition for: {{requirements}}

      Output only the CUE code, no explanations.
testData:
  - requirements: "Node.js app with DATABASE_URL secret resolved via command"
    expected: |
      env: {
        NODE_ENV: "development" | "production"
        DATABASE_URL: schema.#Secret & {
          command: "op"
          args: ["read", "op://vault/db/url"]
        }
      }
  - requirements: "API service with PORT constraint between 1024-65535 and required API_KEY secret"
    expected: |
      env: {
        PORT: >1024 & <65536
        API_KEY: schema.#Secret & {
          command: "op"
          args: ["read", "op://vault/api/key"]
        }
      }
  - requirements: "Simple app with LOG_LEVEL that must be debug, info, warn, or error"
    expected: |
      env: {
        LOG_LEVEL: "debug" | "info" | "warn" | "error"
      }
evaluators:
  - name: Similarity to expected
    uses: github/similarity
  - name: Contains env block
    string:
      contains: "env:"
  - name: Uses CUE constraints or secrets
    string:
      contains: "&"
